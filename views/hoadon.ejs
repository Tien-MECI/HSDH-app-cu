<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>HÓA ĐƠN GIÁ TRỊ GIA TĂNG</title>
<style>
  @page { size: A4 portrait; margin: 0; }

  html, body {
    width: 210mm;
    height: 297mm;
    margin: 0 auto;
    padding: 0;
    background: #fff;
    font-family: "Times New Roman", Times, serif;
    font-size: 12px;
    line-height: 1.3;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    position: relative;
  }

  /* ===== WATERMARK full A4 và căn giữa ===== */
  .watermark {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 210mm;
    height: 297mm;
    z-index: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none;
    opacity: 0.45;
  }
  .watermark img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* ===== KHUNG HÓA ĐƠN ===== */
  .container {
    position: relative;
    z-index: 1;
    width: 190mm; /* nhỏ hơn 210mm một chút để chừa mép */
    min-height: 277mm;
    margin: 10mm auto; /* căn giữa trang */
    padding: 10mm;
    box-sizing: border-box;
    border: 4px solid #2b6ea3;
    background: transparent;
  }

  /* ===== HEADER ===== */
  .header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    border-bottom: 2px solid #000;
    padding-bottom: 6px;
  }
  .logo { width: 100px; height: auto; }
  .header-center { flex: 1; text-align: center; }
  .invoice-title { font-size: 18px; font-weight: 700; text-transform: uppercase; }
  .invoice-sub { font-style: italic; font-size: 13px; }
  .invoice-date { font-size: 12px; margin-top: 4px; }
  .header-right { text-align: right; font-size: 12px; }

  /* ===== SECTION: Seller / Buyer ===== */
  .section {
    border: 1px solid #000;
    padding: 8px;
    margin-top: 8px;
    background: #fff;
    line-height: 1.6; /* dãn dòng dễ đọc hơn */
  }

  /* ===== BẢNG HÀNG HÓA ===== */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }
  th, td {
    border: 1px solid #000;
    padding: 6px;
    font-size: 12px;
    vertical-align: middle;
  }
  thead th {
    font-weight: bold;
    text-align: center;
  }
  td.right { text-align: right; }

  /* ===== SUMMARY ===== */
  .summary-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }
  .summary-table th, .summary-table td {
    border: 1px solid #000;
    padding: 6px;
    font-size: 12px;
    text-align: center;
  }

  .amount-in-words { margin-top: 12px; font-style: italic; }

  /* ===== SIGNATURE ===== */
  .signature {
    display: flex;
    justify-content: space-between;
    margin-top: 25px;
  }
  .signature div {
    width: 45%;
    text-align: center;
  }

  @media print {
    .watermark { opacity: 0.3 !important; }
    .container { border-width: 3px; }
  }
</style>
</head>

<body>
  <!-- WATERMARK -->
  <% if (watermarkBase64) { %>
    <div class="watermark">
      <img src="<%= watermarkBase64 %>" alt="Watermark">
    </div>
  <% } %>

  <!-- NỘI DUNG HÓA ĐƠN -->
  <div class="container">
    <div class="header">
      <img src="/path/logo-meci.png" class="logo" alt="Logo Meci">
      <div class="header-center">
        <div class="invoice-title">HÓA ĐƠN GIÁ TRỊ GIA TĂNG</div>
        <div class="invoice-sub">(VAT INVOICE)</div>
        <div class="invoice-date">Ngày <%= new Date().getDate() %> tháng <%= new Date().getMonth()+1 %> năm <%= new Date().getFullYear() %></div>
      </div>
      <div class="header-right">
        <div>Mẫu số (Form No.): 1</div>
        <div>Ký hiệu (Serial No.): C25T-MECI</div>
        <div>Mã của Cơ quan thuế (Tax Authority Code): 105286765</div>
        <div>Số (Invoice No.): MEC25-10-1258</div>
      </div>
    </div>

    <!-- SELLER -->
    <div class="section">
      <strong>Đơn vị bán hàng (Seller):</strong> CÔNG TY CỔ PHẦN CÔNG NGHIỆP M.E.C.I<br>
      <strong>Mã số thuế (Tax Code):</strong> 0105273501<br>
      <strong>Địa chỉ (Address):</strong> Số 164 đường Nguyễn Trãi, Phường Thanh Xuân, TP Hà Nội, Việt Nam<br>
      <strong>Số điện thoại (Tel):</strong> 0902.227.007 - 0982.934.876 &nbsp; <strong>Website:</strong> www.meci.vn<br>
      <strong>Số tài khoản (Account No.):</strong> 22011686868 tại Ngân hàng TMCP Tiên Phong - Chi nhánh Hoài Đức
    </div>

    <!-- BUYER -->
    <div class="section">
      <strong>Họ tên người mua hàng (Buyer):</strong> ......................................................................<br>
      <strong>Tên đơn vị (Co. name):</strong> <%= order && order.companyName ? order.companyName : "" %><br>
      <strong>Địa chỉ (Address):</strong> <%= order && order.address ? order.address : "" %><br>
      <strong>Số tài khoản (Account No.):</strong> .................................................<br>
      <strong>Hình thức thanh toán (Pay. method):</strong> Tiền mặt/Chuyển khoản &nbsp;
      <strong>Mã số thuế (Tax Code):</strong> <%= order && order.taxCode ? order.taxCode : "" %>
    </div>

    <!-- BẢNG HÀNG HÓA -->
    <table>
      <thead>
        <tr>
          <th>STT<br><em>No.</em></th>
          <th>Tên hàng hóa, dịch vụ<br><em>Description</em></th>
          <th>DVT<br><em>Unit</em></th>
          <th>SL<br><em>Qty</em></th>
          <th>Đơn giá<br><em>Unit price</em></th>
          <th>Tiền chưa thuế<br><em>Amount</em></th>
          <th>Thuế GTGT<br><em>VAT</em></th>
          <th>Thành tiền<br><em>Total</em></th>
        </tr>
      </thead>
      <tbody>
        <% if (items && items.length) { items.forEach((item, i) => { %>
          <tr>
            <td><%= i + 1 %></td>
            <td><%= item.name %></td>
            <td><%= item.unit %></td>
            <td class="right"><%= item.quantity %></td>
            <td class="right"><%= item.price.toLocaleString() %></td>
            <td class="right"><%= item.amount.toLocaleString() %></td>
            <td class="right"><%= item.taxAmount.toLocaleString() %></td>
            <td class="right"><%= item.total.toLocaleString() %></td>
          </tr>
        <% }) } %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="5" class="right"><strong>Tổng cộng (Total)</strong></td>
          <td class="right"><%= totalAmount.toLocaleString() %></td>
          <td class="right"><%= totalTax.toLocaleString() %></td>
          <td class="right"><%= grandTotal.toLocaleString() %></td>
        </tr>
      </tfoot>
    </table>

    <!-- SUMMARY -->
    <table class="summary-table">
      <tr>
        <th>Tổng tiền trước thuế<br>(Amount)</th>
        <th>Tiền thuế GTGT<br>(Tax)</th>
        <th>Tổng cộng<br>(Total)</th>
      </tr>
      <tr>
        <td><%= totalAmount.toLocaleString() %></td>
        <td><%= totalTax.toLocaleString() %></td>
        <td><%= grandTotal.toLocaleString() %></td>
      </tr>
    </table>

    <div class="amount-in-words">
      Số tiền viết bằng chữ (Amount in words): <%= amountInWords %>
    </div>

    <div class="signature">
      <div>Người mua hàng (Buyer)<br>(Ký, ghi rõ họ tên)</div>
      <div>Người bán hàng (Seller)<br>(Ký, ghi rõ họ tên)</div>
    </div>
  </div>
</body>
</html>
