<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>H√≥a ƒë∆°n gi√° tr·ªã gia tƒÉng</title>

<style>
  @page { size: A4 portrait; margin: 0; }

  html, body {
    width: 210mm;
    height: 297mm;
    margin: 0 auto;
    padding: 0;
    font-family: "Times New Roman", Times, serif;
    font-size: 12px;
    line-height: 1.3;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    background: #fff;
  }

  /* WATERMARK full trang, cƒÉn gi·ªØa */
  .watermark {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 210mm;
    height: 297mm;
    z-index: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none;
    opacity: 0.8; /* nh·∫π h∆°n ƒë·ªÉ kh√¥ng che n·ªôi dung */
  }
  .watermark img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /*
    CONTAINER:
    - border: 1mm solid black
    - padding (kho·∫£ng c√°ch gi·ªØa n·ªôi dung v√† khung): 1mm theo y√™u c·∫ßu
    - margin-top: 10mm ƒë·ªÉ kh√¥ng ch·ªìng l√™n watermark vi·ªÅn tr√™n (n·∫øu watermark c√≥ h·ªça ti·∫øt s√°t m√©p)
  */
  .container {
    position: relative;
    z-index: 1;
    width: 190mm;
    min-height: 277mm;
    margin: 10mm auto 0mm;    /* cƒÉn gi·ªØa v√† c√°ch m√©p tr√™n 10mm */
    padding: 1mm 1mm 8mm; /* üëà th√™m 8 mm ƒë·ªám ph√≠a d∆∞·ªõi */
    box-sizing: border-box;
    border: 1mm solid #000; /* vi·ªÅn ƒëen 1mm */
    background: transparent;
  }

  /* Header */
  .header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    border-bottom: 1px solid #000;
    padding-bottom: 6px;
  }
  .logo { width: 120px; height: auto; }
  .header-center { flex: 1; text-align: center; }
  .invoice-title { font-size: 18px; font-weight: 700; text-transform: uppercase; }
  .invoice-sub { font-style: italic; font-size: 13px; }
  .invoice-date { font-size: 12px; margin-top: 4px; }
  .header-right { text-align: right; font-size: 12px; line-height: 1.25; }

  /* Seller/Buyer blocks */
  .section {
    border: 1px solid #000;
    padding: 6px;
    margin-top: 8px;
    background: #fff;
    line-height: 1.6;
  }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }
  th, td {
    border: 1px solid #000;
    padding: 6px;
    font-size: 12px;
    vertical-align: middle;
  }
  thead th {
    font-weight: bold;
    text-align: center;
  }
  th em {
    display: block;
    font-style: italic;
    font-weight: 400;
    font-size: 11px;
    margin-top: 2px;
  }
  td.right { text-align: right; }

  .summary-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }
  .summary-table th, .summary-table td {
    border: 1px solid #000;
    padding: 6px;
    font-size: 12px;
    text-align: center;
  }

  .amount-in-words { margin-top: 12px; font-style: italic; }

  .signature {
    display: flex;
    justify-content: space-between;
    margin-top: 25px;
  }
  .signature div {
    width: 45%;
    text-align: center;
  }

  @media print {
    .watermark { opacity: 0.25 !important; }
    .container {
      border: 1mm solid #000;
      margin: 10mm auto;
      padding: 1mm;
      max-height: calc(297mm - 20mm);
    }
  }
</style>
</head>

<body>
  <% if (watermarkBase64) { %>
    <div class="watermark">
      <img src="<%= watermarkBase64 %>" alt="watermark">
    </div>
  <% } %>

  <div class="container">
    <div class="header">
      <div style="width:140px;">
        <% if (logoBase64) { %>
          <img class="logo" src="<%= logoBase64 %>" alt="logo">
        <% } %>
      </div>

      <div class="header-center">
        <div class="invoice-title">H√ìA ƒê∆†N GI√Å TR·ªä GIA TƒÇNG</div>
        <div class="invoice-sub">(VAT INVOICE)</div>
        <div class="invoice-date">
          Ng√†y <%= today.getDate() %> th√°ng <%= today.getMonth()+1 %> nƒÉm <%= today.getFullYear() %>
        </div>
      </div>

      <div class="header-right">
        <div>M·∫´u s·ªë (Form No.): <strong>1</strong></div>
        <div>K√Ω hi·ªáu (Serial No.): <strong>C25TMC</strong></div>
        <div>S·ªë (Invoice No.): <strong>00000000</strong></div>
      </div>
    </div>

    <div class="section">M√£ CQT (Tax Authority Code): <strong><%= order && order.taxCode ? order.taxCode : "" %></strong></div>

    <!-- SELLER -->
    <div class="section">
      <strong>ƒê∆°n v·ªã b√°n h√†ng (Seller):</strong> C√îNG TY C·ªî PH·∫¶N C√îNG NGHI·ªÜP M.E.C.I<br>
      <strong>M√£ s·ªë thu·∫ø (Tax Code):</strong> 0 1 0 5 2 7 3 5 0 1<br>
      <strong>ƒê·ªãa ch·ªâ (Address):</strong> S·ªë 164 ƒë∆∞·ªùng Nguy·ªÖn Tr√£i, Ph∆∞·ªùng Thanh Xu√¢n, TP H√† N·ªôi, Vi·ªát Nam<br>
      <strong>S·ªë ƒëi·ªán tho·∫°i (Tel):</strong> 0902.227.007 - 0982.934.876 &nbsp; <strong>Website:</strong> www.meci.vn<br>
      <strong>S·ªë t√†i kho·∫£n (Account No.):</strong> 22011686868 t·∫°i Ng√¢n h√†ng TMCP Ti√™n Phong - Chi nh√°nh Ho√†i ƒê·ª©c
    </div>

    <!-- BUYER -->
    <div class="section">
      <strong>H·ªç t√™n ng∆∞·ªùi mua h√†ng (Buyer):</strong> ......................................................................<br>
      <strong>T√™n ƒë∆°n v·ªã (Co. name):</strong> <%= order && order.companyName ? order.companyName : "" %><br>
      <strong>ƒê·ªãa ch·ªâ (Address):</strong> <%= order && order.address ? order.address : "" %><br>
      <strong>S·ªë t√†i kho·∫£n (Account No.):</strong> .................................................<br>
      <strong>H√¨nh th·ª©c thanh to√°n (Pay. method):</strong> Ti·ªÅn m·∫∑t/Chuy·ªÉn kho·∫£n &nbsp;
      <strong>M√£ s·ªë thu·∫ø (Tax Code):</strong> <%= order && order.taxCode ? order.taxCode : "" %>
    </div>

    <!-- PRODUCTS -->
    <table>
      <thead>
        <tr>
          <th>STT<br><em>(No.)</em></th>
          <th>T√™n h√†ng h√≥a, d·ªãch v·ª•<br><em>(Description)</em></th>
          <th>ƒêVT<br><em>(Unit)</em></th>
          <th>SL<br><em>(Qty)</em></th>
          <th>ƒê∆°n gi√°<br><em>(Unit price)</em></th>
          <th>Ti·ªÅn ch∆∞a thu·∫ø<br><em>(Amount)</em></th>
          <th>%</th>
          <th>Ti·ªÅn thu·∫ø<br><em>(VAT)</em></th>
          <th>Th√†nh ti·ªÅn<br><em>(Total)</em></th>
        </tr>
      </thead>

      <tbody>
        <% if (products && products.length) { %>
          <% products.forEach(function(p, idx){ %>
            <tr>
              <td style="text-align:center;"><%= p.stt || (idx+1) %></td>
              <td><%= p.description || "" %></td>
              <td style="text-align:center;"><%= p.unit || "" %></td>
              <td class="right"><%= formatNumber1(p.quantity) %></td>
              <td class="right"><%= formatNumber1(p.unitPrice) %></td>
              <td class="right"><%= formatNumber1(p.amount) %></td>
              <td style="text-align:center;"><%= p.taxRate != null ? p.taxRate + '%' : '' %></td>
              <td class="right"><%= formatNumber1(p.taxAmount) %></td>
              <td class="right"><%= formatNumber1(p.totalAmount) %></td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="9" style="text-align:center;">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>
        <% } %>
      </tbody>

      <tfoot>
        <tr>
          <td colspan="5" style="text-align:right;"><strong>T·ªïng c·ªông (Amount):</strong></td>
          <td class="right"><strong><%= formatNumber1(totalAmountBeforeTax) %></strong></td>
          <td></td>
          <td class="right"><strong><%= formatNumber1(totalTax) %></strong></td>
          <td class="right"><strong><%= formatNumber1(totalAmount) %></strong></td>
        </tr>
      </tfoot>
    </table>

    <!-- SUMMARY -->
    <table class="summary-table">
      <thead>
        <tr>
          <th>T·ªïng h·ª£p</th>
          <th>Thu·∫ø su·∫•t</th>
          <th>Ti·ªÅn tr∆∞·ªõc thu·∫ø</th>
          <th>Ti·ªÅn thu·∫ø GTGT</th>
          <th>T·ªïng thanh to√°n</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align:left;">Thu·∫ø su·∫•t 0%</td>
          <td>0%</td>
          <td class="right"><%= formatNumber1(summary.totalAmount0 || 0) %></td>
          <td class="right">0</td>
          <td class="right"><%= formatNumber1(summary.totalAmount0 || 0) %></td>
        </tr>
        <tr>
          <td style="text-align:left;">Thu·∫ø su·∫•t 8%</td>
          <td>8%</td>
          <td class="right"><%= formatNumber1(summary.totalAmount8 || 0) %></td>
          <td class="right"><%= formatNumber1(summary.totalTax8 || 0) %></td>
          <td class="right"><%= formatNumber1((summary.totalAmount8||0) + (summary.totalTax8||0)) %></td>
        </tr>
        <tr>
          <td style="text-align:left;">Thu·∫ø su·∫•t 10%</td>
          <td>10%</td>
          <td class="right"><%= formatNumber1(summary.totalAmount10 || 0) %></td>
          <td class="right"><%= formatNumber1(summary.totalTax10 || 0) %></td>
          <td class="right"><%= formatNumber1((summary.totalAmount10||0) + (summary.totalTax10||0)) %></td>
        </tr>
        <tr>
          <td colspan="2" style="text-align:center;"><strong>T·ªïng c·ªông</strong></td>
          <td class="right"><strong><%= formatNumber1(totalAmountBeforeTax) %></strong></td>
          <td class="right"><strong><%= formatNumber1(totalTax) %></strong></td>
          <td class="right"><strong><%= formatNumber1(totalAmount) %></strong></td>
        </tr>
      </tbody>
    </table>

    <div class="amount-in-words">
        <% 
        let amountNum = Number(totalAmount);
        if (!isNaN(amountNum)) {
            amountNum = Math.round(amountNum);
        } else {
          amountNum = 0;
        }
        %>
        T·ªïng s·ªë ti·ªÅn vi·∫øt b·∫±ng ch·ªØ (Amount in words): <strong><%= numberToWords1(amountNum) %> ƒë·ªìng ch·∫µn</strong>
    </div>


    <div class="signature">
      <div>Ng∆∞·ªùi mua h√†ng (Buyer)<br><br><br>(K√Ω, ghi r√µ h·ªç t√™n)</div>
      <div>Ng∆∞·ªùi b√°n h√†ng (Seller)<br><br><br>(K√Ω, ghi r√µ h·ªç t√™n)</div>
    </div>

    <div style="text-align:center; margin-top:8px; font-style:italic;">
      (C·∫ßn ki·ªÉm tra ƒë·ªëi chi·∫øu khi l·∫≠p, giao, nh·∫≠n h√≥a ƒë∆°n)
    </div>
  </div>
</body>
</html>
