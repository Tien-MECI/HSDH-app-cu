<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Hóa đơn</title>

<style>
@page { size: A4 portrait; margin: 0.5cm; }

body {
    font-family: "Times New Roman", Times, serif;
    margin: 0;
    padding: 0;
    font-size: 12px;
    line-height: 1.2;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
}

.container {
    width: 100%;
    max-width: 210mm;
    margin: 0 auto;
    position: relative;
    min-height: 297mm;
    padding: 10px;
    box-sizing: border-box;
    border: 4px solid #2b6ea3;
    background: white;
}

/* === WATERMARK FULL A4 === */
.watermark {
    position: absolute;
    top: 0;
    left: 0;
    width: 210mm;
    height: 297mm;
    z-index: 0;
    opacity: 0.18;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none;
}
.watermark img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}
.container > *:not(.watermark) {
    position: relative;
    z-index: 1;
}
@media print {
    .watermark { opacity: 0.25 !important; }
}
</style>
</head>

<body>
<div class="container">
    <% if (watermarkBase64) { %>
    <div class="watermark">
        <img src="<%= watermarkBase64 %>" alt="watermark">
    </div>
    <% } %>

    <h2 style="text-align:center;">HÓA ĐƠN GIÁ TRỊ GIA TĂNG</h2>
    <p><strong>Mã đơn hàng:</strong> <%= order.madh %></p>
    <p><strong>Công ty:</strong> <%= order.companyName %></p>
    <p><strong>MST:</strong> <%= order.taxCode %></p>
    <p><strong>Địa chỉ:</strong> <%= order.address %></p>

    <table border="1" width="100%" cellspacing="0" cellpadding="4">
        <thead>
            <tr>
                <th>STT</th><th>Tên hàng hóa</th><th>ĐVT</th>
                <th>SL</th><th>Đơn giá</th><th>Tiền chưa thuế</th>
                <th>Thuế (%)</th><th>Tiền thuế</th><th>Thành tiền</th>
            </tr>
        </thead>
        <tbody>
        <% products.forEach(p => { %>
            <tr>
                <td><%= p.stt %></td>
                <td><%= p.description %></td>
                <td><%= p.unit %></td>
                <td style="text-align:right;"><%= formatNumber1(p.quantity) %></td>
                <td style="text-align:right;"><%= formatNumber1(p.unitPrice) %></td>
                <td style="text-align:right;"><%= formatNumber1(p.totalBeforeTax) %></td>
                <td style="text-align:right;"><%= p.taxRate %>%</td>
                <td style="text-align:right;"><%= formatNumber1(p.taxAmount) %></td>
                <td style="text-align:right;"><%= formatNumber1(p.totalAfterTax) %></td>
            </tr>
        <% }) %>
        </tbody>
    </table>

    <p><strong>Tổng cộng (chưa thuế):</strong> <%= formatNumber1(summary.totalBeforeTax) %></p>
    <p><strong>Thuế GTGT:</strong> <%= formatNumber1(summary.totalTax) %></p>
    <p><strong>Tổng thanh toán:</strong> <%= formatNumber1(summary.totalAfterTax) %></p>
</div>
</body>
</html>
