<!DOCTYPE html>
<html>

<head>
    <title>Đề Nghị Chung</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 14px;
            margin: 0;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        td,
        th {
            border: 1px solid black;
            padding: 5px;
            text-align: left;
        }

        .header {
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }

        .logo {
            text-align: left;
        }

        .header-right {
            text-align: right;
        }

        .red {
            color: red;
        }

        .center-text {
            text-align: center;
        }

        .no-border {
            border: none;
        }

        /* ✅ Watermark */
        .watermark {
            position: fixed;
            top: 35%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
            opacity: 0.1;
            text-align: center;
        }

        .watermark img {
            width: 80vw;
            height: auto;
        }

        /* CSS cho in ấn */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            body {
                margin: 1.5cm;
                padding: 0;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
    </style>

    <% if (typeof autoPrint !=='undefined' && autoPrint) { %>
        <script>
            window.onload = function () {
                setTimeout(function () {
                    window.print();
                    setTimeout(function () {
                        if (window.opener) {
                            window.close();
                        }
                    }, 500);
                }, 1000);
            };
        </script>
        <% } %>
</head>

<body>
    <% if (watermarkBase64) { %>
        <div class="watermark">
            <img src="<%= watermarkBase64 %>" />
        </div>
        <% } %>

            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td class="no-border">
                        <img class="logo" src="<%= logoBase64 %>" style="width: 80px; height: 40px;" />
                    </td>
                    <td class="no-border" style="text-align: right;">
                        <strong>CÔNG TY CỔ PHẦN CÔNG NGHIỆP MECI</strong>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="border: none; padding: 0;">
                        <div style="border-top: 3px double black; margin: -1px 0 0 0;"></div>
                    </td>
                </tr>
            </table>

            <h2 class="center-text">ĐỀ NGHỊ CHUNG</h2>
            
            <!-- Thông tin đơn hàng -->
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td colspan="2" style="font-weight: bold; text-align: center; font-size: 14px;" width="55%"><b>THÔNG TIN KHÁCH HÀNG</b></td>
                    <td width="15%" style="font-weight: bold; text-align: center; font-size: 14px;"><b>ĐNC CỦA ĐH</b></td>
                    <td width="30%" style="font-weight: bold; text-align: center; font-size: 14px;"><b><%= maDonHang %></b></td>
                </tr>
                <tr>
                    <td width="15%" style="font-weight: bold; font-size: 14px;">Tên KH (Người mua hàng):</td>
                    <td style="text-align: left; font-size: 14px;" width="40%"><%= donHangRecord[17] || donHangRecord[20] || '' %></td>
                    <td width="15%" style="font-weight: bold; font-size: 14px;">Ngày lập:</td>
                    <td style="text-align: left; font-size: 14px;" width="30%"><%= ngayLap %></td>
                </tr>
                <tr>
                    <td style="font-weight: bold; font-size: 14px;" width="15%">Tên công ty:</td>
                    <td style="text-align: left; font-size: 14px;" width="40%"><%= donHangRecord[9] %></td>
                    <td style="font-weight: bold; font-size: 14px;" width="15%">Người lập:</td>
                    <td style="text-align: left; font-size: 14px;" width="30%"><%= donHangRecord[2] %></td>
                </tr>
                <tr>
                    <td style="font-weight: bold; font-size: 14px;" width="15%">Địa chỉ thực hiện:</td>
                    <td style="text-align: left; font-size: 14px;" width="40%"><%= donHangRecord[24] || donHangRecord[26] || donHangRecord[28] || '' %></td>
                    <td style="font-weight: bold; font-size: 14px;" width="15%">Ngày YC thực hiện:</td>
                    <td style="text-align: left; font-size: 14px;" width="30%"><%= ngayYeuCauThucHien %></td>
                </tr>
                <tr>
                    <td style="font-weight: bold; font-size: 14px;" width="15%">Điện thoại (Người nhận hàng):</td>
                    <td style="text-align: left; font-size: 14px;" width="40%"><%= donHangRecord[25] || donHangRecord[27] || donHangRecord[29] || '' %></td>
                    <td style="font-weight: bold; font-size: 14px;" width="15%">Điện thoại/Zalo/Face:</td>
                    <td style="text-align: left; font-size: 14px;" width="30%"><%= donHangRecord[52] %></td>
                </tr>
            </table>

            <h2>BẢNG CHI TIẾT HÀNG HÓA</h2>
            
            <!-- Bảng chi tiết hàng hóa -->
            <table style="width: 100%; font-size: 13px; border-collapse: collapse;">
                <thead>
                    <tr>
                        <% filteredHeaders.forEach(function(header) { %>
                            <th style="text-align: center;"><%= header %></th>
                        <% }); %>
                    </tr>
                </thead>
                <tbody>
                    <% dncRecords.forEach(function(record) { %>
                        <tr>
                            <% filteredColumns.forEach(function(colIndex) { %>
                                <td style="text-align: left; word-wrap: break-word; font-size: 13px;">
                                    <%= record[colIndex - 1] %>
                                </td>
                            <% }); %>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
</body>

</html>